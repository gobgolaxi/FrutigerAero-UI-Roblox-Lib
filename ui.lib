-- Frutiger Aero UI Library V2
local Library = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

-- === НАСТРОЙКИ ТЕМ ===
local Themes = {
	Light = {
		WindowStart = Color3.fromRGB(240, 248, 255),
		WindowEnd = Color3.fromRGB(176, 224, 230),
		HeaderStart = Color3.fromRGB(0, 191, 255),
		HeaderEnd = Color3.fromRGB(0, 100, 200),
		ElementBg = Color3.fromRGB(255, 255, 255),
		Text = Color3.fromRGB(20, 20, 20),
		Accent = Color3.fromRGB(50, 205, 50), -- Lime Green
		Stroke = Color3.fromRGB(100, 150, 200),
		GlassTransparency = 0.2
	},
	Dark = {
		WindowStart = Color3.fromRGB(45, 45, 50),
		WindowEnd = Color3.fromRGB(25, 25, 30),
		HeaderStart = Color3.fromRGB(0, 120, 215), -- Deep Blue
		HeaderEnd = Color3.fromRGB(0, 60, 120),
		ElementBg = Color3.fromRGB(60, 60, 65),
		Text = Color3.fromRGB(240, 240, 240),
		Accent = Color3.fromRGB(0, 255, 255), -- Cyan Neon
		Stroke = Color3.fromRGB(80, 80, 90),
		GlassTransparency = 0.15
	}
}

-- Текущая тема (по дефолту Light)
local CurrentTheme = Themes.Light

-- Хелпер для глянца
local function AddGloss(instance)
	local Gloss = Instance.new("Frame")
	Gloss.Name = "Gloss"
	Gloss.Size = UDim2.new(1, 0, 0.5, 0)
	Gloss.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	Gloss.BackgroundTransparency = 0.85
	Gloss.BorderSizePixel = 0
	Gloss.ZIndex = instance.ZIndex + 1
	Gloss.Parent = instance
	
	local Corner = instance:FindFirstChildWhichIsA("UICorner")
	if Corner then
		local NewCorner = Corner:Clone()
		NewCorner.Parent = Gloss
	end
end

-- Хелпер для драга
local function MakeDraggable(topbarobject, object)
	local Dragging = nil
	local DragInput = nil
	local DragStart = nil
	local StartPosition = nil

	topbarobject.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			Dragging = true
			DragStart = input.Position
			StartPosition = object.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					Dragging = false
				end
			end)
		end
	end)

	topbarobject.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			DragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == DragInput and Dragging then
			local Delta = input.Position - DragStart
			object.Position = UDim2.new(StartPosition.X.Scale, StartPosition.X.Offset + Delta.X, StartPosition.Y.Scale, StartPosition.Y.Offset + Delta.Y)
		end
	end)
end

-- Уведомление снизу с авто-шириной
function Library:Notify(text)
	local ScreenGui = game.CoreGui:FindFirstChild("AeroLib") or game.Players.LocalPlayer.PlayerGui:FindFirstChild("AeroLib")
	if not ScreenGui then return end
	
	-- Определяем ширину по тексту
	local tempLabel = Instance.new("TextLabel")
	tempLabel.Font = Enum.Font.GothamBold
	tempLabel.TextSize = 14
	tempLabel.Text = text
	
	-- Приблизительный расчет ширины (примерно 8 пикселей на символ)
	local textWidth = math.max(200, #text * 8 + 40)
	tempLabel:Destroy()
	
	-- Создаем уведомление
	local Notif = Instance.new("TextLabel")
	Notif.Text = text
	Notif.Size = UDim2.new(0, textWidth, 0, 40)
	Notif.Position = UDim2.new(0.5, -textWidth/2, 1, 0) -- Старт снизу
	Notif.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	Notif.BackgroundTransparency = 0.5
	Notif.TextColor3 = Color3.fromRGB(255, 255, 255)
	Notif.Font = Enum.Font.GothamBold
	Notif.TextSize = 14
	Notif.TextWrapped = true
	Notif.Parent = ScreenGui
	
	local Corner = Instance.new("UICorner")
	Corner.CornerRadius = UDim.new(0, 8)
	Corner.Parent = Notif
	
	-- Анимация появления
	TweenService:Create(Notif, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Position = UDim2.new(0.5, -textWidth/2, 1, -60)}):Play()
	
	task.delay(3, function()
		TweenService:Create(Notif, TweenInfo.new(0.5, Enum.EasingStyle.Quad), {Position = UDim2.new(0.5, -textWidth/2, 1, 0)}):Play()
		task.wait(0.5)
		Notif:Destroy()
	end)
end

function Library:CreateWindow(settings)
	local TitleText = settings.Title or "Frutiger Aero"
	local ThemeName = settings.Theme or "Light"
	local ToggleKey = settings.Key or Enum.KeyCode.M
	
	if ThemeName == "Dark" then CurrentTheme = Themes.Dark else CurrentTheme = Themes.Light end

	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "AeroLib"
	ScreenGui.ResetOnSpawn = false
	-- Пытаемся засунуть в CoreGui для безопасности, иначе в PlayerGui
	if pcall(function() ScreenGui.Parent = CoreGui end) then
	else ScreenGui.Parent = game.Players.LocalPlayer.PlayerGui end
	
	-- Эффект блюра (Global Acrylic)
	local Blur = Instance.new("BlurEffect")
	Blur.Name = "AeroBlur"
	Blur.Size = 0
	Blur.Parent = game:GetService("Lighting")
	
	-- Функция обновления блюра
	local function SetBlur(state)
		local targetSize = state and 24 or 0
		TweenService:Create(Blur, TweenInfo.new(0.5), {Size = targetSize}):Play()
	end
	
	SetBlur(false) -- Включаем сразу

	-- Главный Фрейм
	local MainFrame = Instance.new("Frame")
	MainFrame.Name = "MainFrame"
	MainFrame.Size = UDim2.new(0, 550, 0, 400)
	MainFrame.Position = UDim2.new(0.5, -275, 0.5, -200)
	MainFrame.BackgroundColor3 = CurrentTheme.WindowEnd
	MainFrame.BackgroundTransparency = CurrentTheme.GlassTransparency
	MainFrame.ClipsDescendants = true
	MainFrame.Parent = ScreenGui
	
	local MainCorner = Instance.new("UICorner")
	MainCorner.CornerRadius = UDim.new(0, 12)
	MainCorner.Parent = MainFrame
	
	-- Градиент фона
	local MainGradient = Instance.new("UIGradient")
	MainGradient.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, CurrentTheme.WindowStart),
		ColorSequenceKeypoint.new(1, CurrentTheme.WindowEnd)
	}
	MainGradient.Rotation = 90
	MainGradient.Parent = MainFrame
	
	-- Обводка
	local Stroke = Instance.new("UIStroke")
	Stroke.Color = CurrentTheme.Stroke
	Stroke.Thickness = 2
	Stroke.Parent = MainFrame

	-- TopBar
	local TopBar = Instance.new("Frame")
	TopBar.Name = "TopBar"
	TopBar.Size = UDim2.new(1, 0, 0, 40)
	TopBar.BackgroundColor3 = CurrentTheme.HeaderStart
	TopBar.Parent = MainFrame
	
	local TopBarCorner = Instance.new("UICorner")
	TopBarCorner.CornerRadius = UDim.new(0, 12)
	TopBarCorner.Parent = TopBar
	
	-- Прячем нижние углы TopBar
	local HideBottom = Instance.new("Frame")
	HideBottom.Size = UDim2.new(1, 0, 0.5, 0)
	HideBottom.Position = UDim2.new(0, 0, 0.5, 0)
	HideBottom.BackgroundColor3 = CurrentTheme.HeaderEnd
	HideBottom.BorderSizePixel = 0
	HideBottom.Parent = TopBar

	local TopBarGradient = Instance.new("UIGradient")
	TopBarGradient.Color = ColorSequence.new{
		ColorSequenceKeypoint.new(0, CurrentTheme.HeaderStart),
		ColorSequenceKeypoint.new(1, CurrentTheme.HeaderEnd)
	}
	TopBarGradient.Rotation = 90
	TopBarGradient.Parent = TopBar
	
	AddGloss(TopBar)
	
	local Title = Instance.new("TextLabel")
	Title.Text = TitleText
	Title.Size = UDim2.new(1, -100, 1, 0)
	Title.Position = UDim2.new(0, 15, 0, 0)
	Title.BackgroundTransparency = 1
	Title.TextColor3 = Color3.fromRGB(255, 255, 255)
	Title.Font = Enum.Font.GothamBold
	Title.TextSize = 18
	Title.TextXAlignment = Enum.TextXAlignment.Left
	Title.Parent = TopBar
	
	-- Text Shadow
	local TitleShadow = Title:Clone()
	TitleShadow.TextColor3 = Color3.new(0,0,0)
	TitleShadow.TextTransparency = 0.5
	TitleShadow.Position = UDim2.new(0, 16, 0, 1)
	TitleShadow.ZIndex = Title.ZIndex - 1
	TitleShadow.Parent = TopBar

	MakeDraggable(TopBar, MainFrame)
	
	-- === КНОПКА ЗАКРЫТИЯ ===
	local CloseBtn = Instance.new("TextButton")
	CloseBtn.Size = UDim2.new(0, 30, 0, 30)
	CloseBtn.Position = UDim2.new(1, -35, 0.5, -15)
	CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
	CloseBtn.BackgroundTransparency = 0.5
	CloseBtn.Text = "X"
	CloseBtn.Font = Enum.Font.GothamBold
	CloseBtn.TextColor3 = Color3.new(1,1,1)
	CloseBtn.TextSize = 14
	CloseBtn.Parent = TopBar
	
	local CloseCorner = Instance.new("UICorner")
	CloseCorner.CornerRadius = UDim.new(0, 6)
	CloseCorner.Parent = CloseBtn
	
	-- === ПЛАВАЮЩАЯ КНОПКА ДЛЯ ОТКРЫТИЯ ===
	local OpenButton = Instance.new("TextButton")
	OpenButton.Name = "OpenButton"
	OpenButton.Size = UDim2.new(0, 50, 0, 50)
	OpenButton.Position = UDim2.new(0, 20, 0, 20)
	OpenButton.BackgroundColor3 = CurrentTheme.HeaderStart
	OpenButton.BackgroundTransparency = 0.3
	OpenButton.Text = "☰"
	OpenButton.TextColor3 = Color3.new(1, 1, 1)
	OpenButton.Font = Enum.Font.GothamBold
	OpenButton.TextSize = 20
	OpenButton.Visible = false -- Скрыта по умолчанию
	OpenButton.Parent = ScreenGui
	
	local OpenButtonCorner = Instance.new("UICorner")
	OpenButtonCorner.CornerRadius = UDim.new(0, 10)
	OpenButtonCorner.Parent = OpenButton
	
	local OpenButtonStroke = Instance.new("UIStroke")
	OpenButtonStroke.Color = CurrentTheme.Stroke
	OpenButtonStroke.Thickness = 2
	OpenButtonStroke.Parent = OpenButton
	
	AddGloss(OpenButton)
	
	-- Делаем кнопку открытия перетаскиваемой
	MakeDraggable(OpenButton, OpenButton)
	
	-- === ЛОГИКА ОТКРЫТИЯ/ЗАКРЫТИЯ ===
	local isOpen = true
	
	local function CloseUI()
		isOpen = false
		MainFrame.Visible = false
		OpenButton.Visible = true
		SetBlur(false)
		Library:Notify("Нажми '"..ToggleKey.Name.."' или кнопку для открытия меню")
	end
	
	local function OpenUI()
		isOpen = true
		MainFrame.Visible = true
		OpenButton.Visible = false
		SetBlur(true)
	end
	
	CloseBtn.MouseButton1Click:Connect(CloseUI)
	OpenButton.MouseButton1Click:Connect(OpenUI)
	
	-- Горячая клавиша
	UserInputService.InputBegan:Connect(function(input, processed)
		if not processed and input.KeyCode == ToggleKey then
			if isOpen then
				CloseUI()
			else
				OpenUI()
			end
		end
	end)

	-- === КОНТЕНТ ===
	local TabContainer = Instance.new("ScrollingFrame")
	TabContainer.Size = UDim2.new(0, 130, 1, -55)
	TabContainer.Position = UDim2.new(0, 10, 0, 45)
	TabContainer.BackgroundTransparency = 0.6
	TabContainer.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	if CurrentTheme == Themes.Light then
		TabContainer.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	end
	TabContainer.BorderSizePixel = 0
	TabContainer.ScrollBarThickness = 0
	TabContainer.Parent = MainFrame
	
	local TabCorner = Instance.new("UICorner")
	TabCorner.CornerRadius = UDim.new(0, 8)
	TabCorner.Parent = TabContainer
	
	local TabList = Instance.new("UIListLayout")
	TabList.Padding = UDim.new(0, 5)
	TabList.SortOrder = Enum.SortOrder.LayoutOrder
	TabList.Parent = TabContainer
	
	local TabPad = Instance.new("UIPadding")
	TabPad.PaddingTop = UDim.new(0, 5)
	TabPad.PaddingLeft = UDim.new(0, 5)
	TabPad.Parent = TabContainer
	
	local PageContainer = Instance.new("Frame")
	PageContainer.Size = UDim2.new(1, -160, 1, -55)
	PageContainer.Position = UDim2.new(0, 150, 0, 45)
	PageContainer.BackgroundTransparency = 1
	PageContainer.Parent = MainFrame
	
	local PagesFolder = Instance.new("Folder")
	PagesFolder.Name = "Pages"
	PagesFolder.Parent = PageContainer

	-- Интерфейс создания элементов
	local Window = {}
	
	function Window:Tab(name)
		local TabBtn = Instance.new("TextButton")
		TabBtn.Text = name
		TabBtn.Size = UDim2.new(1, -10, 0, 32)
		TabBtn.BackgroundColor3 = CurrentTheme.ElementBg
		TabBtn.BackgroundTransparency = 0.5
		TabBtn.TextColor3 = CurrentTheme.Text
		TabBtn.Font = Enum.Font.GothamSemibold
		TabBtn.TextSize = 14
		TabBtn.Parent = TabContainer
		
		local TabBtnCorner = Instance.new("UICorner")
		TabBtnCorner.CornerRadius = UDim.new(0, 6)
		TabBtnCorner.Parent = TabBtn
		
		local Page = Instance.new("ScrollingFrame")
		Page.Name = name
		Page.Size = UDim2.new(1, 0, 1, 0)
		Page.BackgroundTransparency = 1
		Page.ScrollBarThickness = 3
		Page.Visible = false
		Page.Parent = PagesFolder
		
		local PageLayout = Instance.new("UIListLayout")
		PageLayout.Padding = UDim.new(0, 8)
		PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
		PageLayout.Parent = Page
		
		local PagePad = Instance.new("UIPadding")
		PagePad.PaddingTop = UDim.new(0, 2)
		PagePad.PaddingRight = UDim.new(0, 5)
		PagePad.Parent = Page
		
		TabBtn.MouseButton1Click:Connect(function()
			for _, p in pairs(PagesFolder:GetChildren()) do p.Visible = false end
			Page.Visible = true
			
			for _, t in pairs(TabContainer:GetChildren()) do
				if t:IsA("TextButton") then
					TweenService:Create(t, TweenInfo.new(0.2), {BackgroundColor3 = CurrentTheme.ElementBg, TextColor3 = CurrentTheme.Text}):Play()
				end
			end
			TweenService:Create(TabBtn, TweenInfo.new(0.2), {BackgroundColor3 = CurrentTheme.HeaderStart, TextColor3 = Color3.new(1,1,1)}):Play()
		end)
		
		if #PagesFolder:GetChildren() == 1 then
			TabBtn.BackgroundColor3 = CurrentTheme.HeaderStart
			TabBtn.TextColor3 = Color3.new(1,1,1)
			Page.Visible = true
		end
		
		local Elements = {}
		
		function Elements:Button(text, callback)
			local Btn = Instance.new("TextButton")
			Btn.Size = UDim2.new(1, 0, 0, 35)
			Btn.BackgroundColor3 = CurrentTheme.ElementBg
			Btn.Text = text
			Btn.TextColor3 = CurrentTheme.Text
			Btn.Font = Enum.Font.Gotham
			Btn.TextSize = 14
			Btn.Parent = Page
			
			local Corner = Instance.new("UICorner")
			Corner.CornerRadius = UDim.new(0, 8)
			Corner.Parent = Btn
			
			local Stroke = Instance.new("UIStroke")
			Stroke.Color = CurrentTheme.Stroke
			Stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
			Stroke.Parent = Btn
			
			AddGloss(Btn)
			
			Btn.MouseButton1Click:Connect(function()
				callback()
				TweenService:Create(Btn, TweenInfo.new(0.1), {Size = UDim2.new(1, -4, 0, 31)}):Play()
				task.wait(0.1)
				TweenService:Create(Btn, TweenInfo.new(0.1), {Size = UDim2.new(1, 0, 0, 35)}):Play()
			end)
		end
		
		function Elements:Toggle(text, default, callback)
			local Frame = Instance.new("TextButton")
			Frame.Size = UDim2.new(1, 0, 0, 35)
			Frame.BackgroundColor3 = CurrentTheme.ElementBg
			Frame.Text = ""
			Frame.AutoButtonColor = false
			Frame.Parent = Page
			
			local Corner = Instance.new("UICorner")
			Corner.CornerRadius = UDim.new(0, 8)
			Corner.Parent = Frame
			
			local Label = Instance.new("TextLabel")
			Label.Text = text
			Label.Size = UDim2.new(1, -40, 1, 0)
			Label.Position = UDim2.new(0, 10, 0, 0)
			Label.BackgroundTransparency = 1
			Label.TextXAlignment = Enum.TextXAlignment.Left
			Label.TextColor3 = CurrentTheme.Text
			Label.Font = Enum.Font.Gotham
			Label.TextSize = 14
			Label.Parent = Frame
			
			local CheckBox = Instance.new("Frame")
			CheckBox.Size = UDim2.new(0, 20, 0, 20)
			CheckBox.Position = UDim2.new(1, -30, 0.5, -10)
			CheckBox.BackgroundColor3 = Color3.fromRGB(240,240,240)
			CheckBox.Parent = Frame
			
			local CheckCorner = Instance.new("UICorner")
			CheckCorner.CornerRadius = UDim.new(0, 4)
			CheckCorner.Parent = CheckBox
			
			local CheckIndicator = Instance.new("Frame")
			CheckIndicator.Size = UDim2.new(1, -6, 1, -6)
			CheckIndicator.Position = UDim2.new(0, 3, 0, 3)
			CheckIndicator.BackgroundColor3 = CurrentTheme.Accent
			CheckIndicator.BackgroundTransparency = default and 0 or 1
			CheckIndicator.Parent = CheckBox
			
			local IndCorner = Instance.new("UICorner")
			IndCorner.CornerRadius = UDim.new(0, 3)
			IndCorner.Parent = CheckIndicator
			
			local state = default
			
			Frame.MouseButton1Click:Connect(function()
				state = not state
				TweenService:Create(CheckIndicator, TweenInfo.new(0.2), {BackgroundTransparency = state and 0 or 1}):Play()
				callback(state)
			end)
		end
		
		function Elements:Slider(text, min, max, default, callback)
			local Frame = Instance.new("Frame")
			Frame.Size = UDim2.new(1, 0, 0, 50)
			Frame.BackgroundColor3 = CurrentTheme.ElementBg
			Frame.Parent = Page
			
			local Corner = Instance.new("UICorner")
			Corner.CornerRadius = UDim.new(0, 8)
			Corner.Parent = Frame
			
			local Label = Instance.new("TextLabel")
			Label.Text = text
			Label.Position = UDim2.new(0, 10, 0, 5)
			Label.Size = UDim2.new(1, -50, 0, 20)
			Label.BackgroundTransparency = 1
			Label.TextXAlignment = Enum.TextXAlignment.Left
			Label.TextColor3 = CurrentTheme.Text
			Label.Font = Enum.Font.Gotham
			Label.TextSize = 14
			Label.Parent = Frame
			
			local ValueLabel = Instance.new("TextLabel")
			ValueLabel.Text = tostring(default)
			ValueLabel.Position = UDim2.new(1, -40, 0, 5)
			ValueLabel.Size = UDim2.new(0, 30, 0, 20)
			ValueLabel.BackgroundTransparency = 1
			ValueLabel.TextColor3 = CurrentTheme.Accent
			ValueLabel.Font = Enum.Font.GothamBold
			ValueLabel.TextSize = 14
			ValueLabel.Parent = Frame
			
			local Track = Instance.new("TextButton")
			Track.Text = ""
			Track.Size = UDim2.new(1, -20, 0, 10)
			Track.Position = UDim2.new(0, 10, 0, 30)
			Track.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
			Track.AutoButtonColor = false
			Track.Parent = Frame
			
			local TrackCorner = Instance.new("UICorner")
			TrackCorner.CornerRadius = UDim.new(1, 0)
			TrackCorner.Parent = Track
			
			local Fill = Instance.new("Frame")
			Fill.Size = UDim2.new((default - min)/(max - min), 0, 1, 0)
			Fill.BackgroundColor3 = CurrentTheme.Accent
			Fill.Parent = Track
			
			local FillCorner = Instance.new("UICorner")
			FillCorner.CornerRadius = UDim.new(1, 0)
			FillCorner.Parent = Fill
			
			local isDragging = false
			
			local function Update(input)
				local pos = math.clamp((input.Position.X - Track.AbsolutePosition.X) / Track.AbsoluteSize.X, 0, 1)
				local val = math.floor(min + ((max - min) * pos))
				TweenService:Create(Fill, TweenInfo.new(0.1), {Size = UDim2.new(pos, 0, 1, 0)}):Play()
				ValueLabel.Text = tostring(val)
				callback(val)
			end
			
			Track.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					isDragging = true
					Update(input)
				end
			end)
			
			UserInputService.InputChanged:Connect(function(input)
				if isDragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
					Update(input)
				end
			end)
			
			UserInputService.InputEnded:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					isDragging = false
				end
			end)
		end
		
function Elements:StringOption(text, placeholder, default, callback)
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(1, 0, 0, 50)
    Frame.BackgroundColor3 = CurrentTheme.ElementBg
    Frame.Parent = Page
    
    local Corner = Instance.new("UICorner")
    Corner.CornerRadius = UDim.new(0, 8)
    Corner.Parent = Frame
    
    local Label = Instance.new("TextLabel")
    Label.Text = text
    Label.Position = UDim2.new(0, 10, 0, 5)
    Label.Size = UDim2.new(1, -20, 0, 20)
    Label.BackgroundTransparency = 1
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.TextColor3 = CurrentTheme.Text
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 14
    Label.Parent = Frame
    
    local TextBoxFrame = Instance.new("Frame")
    TextBoxFrame.Size = UDim2.new(1, -20, 0, 20)
    TextBoxFrame.Position = UDim2.new(0, 10, 0, 25)
    TextBoxFrame.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
    if CurrentTheme == Themes.Dark then
        TextBoxFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    end
    TextBoxFrame.Parent = Frame
    
    local TextBoxCorner = Instance.new("UICorner")
    TextBoxCorner.CornerRadius = UDim.new(0, 4)
    TextBoxCorner.Parent = TextBoxFrame
    
    local TextBox = Instance.new("TextBox")
    TextBox.Size = UDim2.new(1, -10, 1, 0)
    TextBox.Position = UDim2.new(0, 5, 0, 0)
    TextBox.BackgroundTransparency = 1
    TextBox.Text = default or ""
    TextBox.PlaceholderText = placeholder or "Введите текст..."
    TextBox.TextColor3 = CurrentTheme.Text
    TextBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    TextBox.Font = Enum.Font.Gotham
    TextBox.TextSize = 14
    TextBox.TextXAlignment = Enum.TextXAlignment.Left
    TextBox.ClearTextOnFocus = false
    TextBox.Parent = TextBoxFrame
    
    local SubmitBtn = Instance.new("TextButton")
    SubmitBtn.Text = "✓"
    SubmitBtn.Size = UDim2.new(0, 25, 0, 20)
    SubmitBtn.Position = UDim2.new(1, -30, 0.5, -10)
    SubmitBtn.BackgroundColor3 = CurrentTheme.Accent
    SubmitBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    SubmitBtn.Font = Enum.Font.GothamBold
    SubmitBtn.TextSize = 12
    SubmitBtn.Visible = false
    SubmitBtn.Parent = Frame
    
    local SubmitCorner = Instance.new("UICorner")
    SubmitCorner.CornerRadius = UDim.new(0, 4)
    SubmitCorner.Parent = SubmitBtn
    
    -- Сохраняем значение при любом изменении
    local lastText = TextBox.Text
    TextBox:GetPropertyChangedSignal("Text"):Connect(function()
        if TextBox.Text ~= lastText then
            lastText = TextBox.Text
            callback(TextBox.Text) -- Автоматически сохраняем при каждом изменении
        end
    end)
    
    -- Фокус на текстовое поле
    TextBox.Focused:Connect(function()
        TweenService:Create(TextBoxFrame, TweenInfo.new(0.2), {
            BackgroundColor3 = Color3.fromRGB(220, 220, 230),
            Size = UDim2.new(1, -50, 0, 20)
        }):Play()
        SubmitBtn.Visible = true
    end)
    
    TextBox.FocusLost:Connect(function(enterPressed)
        TweenService:Create(TextBoxFrame, TweenInfo.new(0.2), {
            BackgroundColor3 = CurrentTheme == Themes.Dark and Color3.fromRGB(40, 40, 45) or Color3.fromRGB(240, 240, 240),
            Size = UDim2.new(1, -20, 0, 20)
        }):Play()
        SubmitBtn.Visible = false
        
        -- Сохраняем даже без Enter
        if TextBox.Text ~= lastText then
            lastText = TextBox.Text
            callback(TextBox.Text)
        end
    end)
    
    -- Кнопка подтверждения (дополнительный способ)
    SubmitBtn.MouseButton1Click:Connect(function()
        callback(TextBox.Text)
        TextBox:ReleaseFocus()
    end)
    
    -- Анимация при нажатии на кнопку
    SubmitBtn.MouseButton1Down:Connect(function()
        TweenService:Create(SubmitBtn, TweenInfo.new(0.1), {Size = UDim2.new(0, 23, 0, 18)}):Play()
    end)
    
    SubmitBtn.MouseButton1Up:Connect(function()
        TweenService:Create(SubmitBtn, TweenInfo.new(0.1), {Size = UDim2.new(0, 25, 0, 20)}):Play()
    end)
end
		
		-- НОВЫЙ: ListSetting - множественный выбор
		function Elements:ListSetting(text, options, default, callback)
			local Frame = Instance.new("Frame")
			Frame.Size = UDim2.new(1, 0, 0, 35 + (#options * 25))
			Frame.BackgroundColor3 = CurrentTheme.ElementBg
			Frame.Parent = Page
			
			local Corner = Instance.new("UICorner")
			Corner.CornerRadius = UDim.new(0, 8)
			Corner.Parent = Frame
			
			local Label = Instance.new("TextLabel")
			Label.Text = text
			Label.Position = UDim2.new(0, 10, 0, 5)
			Label.Size = UDim2.new(1, -20, 0, 20)
			Label.BackgroundTransparency = 1
			Label.TextXAlignment = Enum.TextXAlignment.Left
			Label.TextColor3 = CurrentTheme.Text
			Label.Font = Enum.Font.Gotham
			Label.TextSize = 14
			Label.Parent = Frame
			
			local OptionsFrame = Instance.new("Frame")
			OptionsFrame.Size = UDim2.new(1, -20, 0, #options * 25)
			OptionsFrame.Position = UDim2.new(0, 10, 0, 30)
			OptionsFrame.BackgroundTransparency = 1
			OptionsFrame.Parent = Frame
			
			local OptionsLayout = Instance.new("UIListLayout")
			OptionsLayout.Padding = UDim.new(0, 5)
			OptionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
			OptionsLayout.Parent = OptionsFrame
			
			local selectedOptions = default or {}
			
			for i, option in pairs(options) do
				local OptionFrame = Instance.new("TextButton")
				OptionFrame.Size = UDim2.new(1, 0, 0, 20)
				OptionFrame.BackgroundTransparency = 1
				OptionFrame.Text = ""
				OptionFrame.AutoButtonColor = false
				OptionFrame.Parent = OptionsFrame
				
				local CheckBox = Instance.new("Frame")
				CheckBox.Size = UDim2.new(0, 15, 0, 15)
				CheckBox.Position = UDim2.new(0, 0, 0.5, -7.5)
				CheckBox.BackgroundColor3 = Color3.fromRGB(240,240,240)
				CheckBox.Parent = OptionFrame
				
				local CheckCorner = Instance.new("UICorner")
				CheckCorner.CornerRadius = UDim.new(0, 3)
				CheckCorner.Parent = CheckBox
				
				local CheckIndicator = Instance.new("Frame")
				CheckIndicator.Size = UDim2.new(1, -4, 1, -4)
				CheckIndicator.Position = UDim2.new(0, 2, 0, 2)
				CheckIndicator.BackgroundColor3 = CurrentTheme.Accent
				CheckIndicator.BackgroundTransparency = selectedOptions[option] and 0 or 1
				CheckIndicator.Parent = CheckBox
				
				local IndCorner = Instance.new("UICorner")
				IndCorner.CornerRadius = UDim.new(0, 2)
				IndCorner.Parent = CheckIndicator
				
				local OptionLabel = Instance.new("TextLabel")
				OptionLabel.Text = option
				OptionLabel.Size = UDim2.new(1, -25, 1, 0)
				OptionLabel.Position = UDim2.new(0, 20, 0, 0)
				OptionLabel.BackgroundTransparency = 1
				OptionLabel.TextXAlignment = Enum.TextXAlignment.Left
				OptionLabel.TextColor3 = CurrentTheme.Text
				OptionLabel.Font = Enum.Font.Gotham
				OptionLabel.TextSize = 12
				OptionLabel.Parent = OptionFrame
				
				OptionFrame.MouseButton1Click:Connect(function()
					selectedOptions[option] = not selectedOptions[option]
					TweenService:Create(CheckIndicator, TweenInfo.new(0.2), {
						BackgroundTransparency = selectedOptions[option] and 0 or 1
					}):Play()
					
					-- Преобразуем таблицу в массив выбранных опций
					local selectedArray = {}
					for opt, isSelected in pairs(selectedOptions) do
						if isSelected then
							table.insert(selectedArray, opt)
						end
					end
					
					callback(selectedOptions, selectedArray)
				end)
			end
		end
		
		-- НОВЫЙ: ModeSetting - выбор одного из нескольких
		function Elements:ModeSetting(text, options, default, callback)
			local Frame = Instance.new("Frame")
			Frame.Size = UDim2.new(1, 0, 0, 35 + (#options * 25))
			Frame.BackgroundColor3 = CurrentTheme.ElementBg
			Frame.Parent = Page
			
			local Corner = Instance.new("UICorner")
			Corner.CornerRadius = UDim.new(0, 8)
			Corner.Parent = Frame
			
			local Label = Instance.new("TextLabel")
			Label.Text = text
			Label.Position = UDim2.new(0, 10, 0, 5)
			Label.Size = UDim2.new(1, -20, 0, 20)
			Label.BackgroundTransparency = 1
			Label.TextXAlignment = Enum.TextXAlignment.Left
			Label.TextColor3 = CurrentTheme.Text
			Label.Font = Enum.Font.Gotham
			Label.TextSize = 14
			Label.Parent = Frame
			
			local OptionsFrame = Instance.new("Frame")
			OptionsFrame.Size = UDim2.new(1, -20, 0, #options * 25)
			OptionsFrame.Position = UDim2.new(0, 10, 0, 30)
			OptionsFrame.BackgroundTransparency = 1
			OptionsFrame.Parent = Frame
			
			local OptionsLayout = Instance.new("UIListLayout")
			OptionsLayout.Padding = UDim.new(0, 5)
			OptionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
			OptionsLayout.Parent = OptionsFrame
			
			local selectedMode = default or options[1]
			local modeButtons = {}
			
			for i, option in pairs(options) do
				local OptionFrame = Instance.new("TextButton")
				OptionFrame.Size = UDim2.new(1, 0, 0, 20)
				OptionFrame.BackgroundTransparency = 1
				OptionFrame.Text = ""
				OptionFrame.AutoButtonColor = false
				OptionFrame.Parent = OptionsFrame
				
				local RadioOuter = Instance.new("Frame")
				RadioOuter.Size = UDim2.new(0, 15, 0, 15)
				RadioOuter.Position = UDim2.new(0, 0, 0.5, -7.5)
				RadioOuter.BackgroundColor3 = Color3.fromRGB(240,240,240)
				RadioOuter.Parent = OptionFrame
				
				local RadioCorner = Instance.new("UICorner")
				RadioCorner.CornerRadius = UDim.new(1, 0)
				RadioCorner.Parent = RadioOuter
				
				local RadioIndicator = Instance.new("Frame")
				RadioIndicator.Size = UDim2.new(0, 7, 0, 7)
				RadioIndicator.Position = UDim2.new(0.5, -3.5, 0.5, -3.5)
				RadioIndicator.BackgroundColor3 = CurrentTheme.Accent
				RadioIndicator.BackgroundTransparency = option == selectedMode and 0 or 1
				RadioIndicator.Parent = RadioOuter
				
				local RadioInnerCorner = Instance.new("UICorner")
				RadioInnerCorner.CornerRadius = UDim.new(1, 0)
				RadioInnerCorner.Parent = RadioIndicator
				
				local OptionLabel = Instance.new("TextLabel")
				OptionLabel.Text = option
				OptionLabel.Size = UDim2.new(1, -25, 1, 0)
				OptionLabel.Position = UDim2.new(0, 20, 0, 0)
				OptionLabel.BackgroundTransparency = 1
				OptionLabel.TextXAlignment = Enum.TextXAlignment.Left
				OptionLabel.TextColor3 = CurrentTheme.Text
				OptionLabel.Font = Enum.Font.Gotham
				OptionLabel.TextSize = 12
				OptionLabel.Parent = OptionFrame
				
				modeButtons[option] = {
					Frame = OptionFrame,
					Indicator = RadioIndicator
				}
				
				OptionFrame.MouseButton1Click:Connect(function()
					-- Сбрасываем все индикаторы
					for mode, btnData in pairs(modeButtons) do
						TweenService:Create(btnData.Indicator, TweenInfo.new(0.2), {
							BackgroundTransparency = 1
						}):Play()
					end
					
					-- Включаем выбранный
					selectedMode = option
					TweenService:Create(modeButtons[option].Indicator, TweenInfo.new(0.2), {
						BackgroundTransparency = 0
					}):Play()
					
					callback(selectedMode)
				end)
			end
		end
		
		return Elements
	end

	return Window
end

return Library
